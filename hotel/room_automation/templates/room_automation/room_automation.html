{% extends 'base.html' %}
{% block content %}
  <form class="row g-3" id="room_select">
    <div class="col-lg-2">
      <label for="{{ room_select.number.id_for_label }}" class="form-label">{{ room_select.number.label }}</label>
      {{ room_select.number.as_widget }}
    </div>
    <hr class="mt-3 mb-3">
  </form>

  <p class="d-none" id="error_msg"></p>
  <div class="row d-none" id="room_content">
    <h3 class="text-center mb-4" id="room_number"></h3>

    <div class="col-lg-6 text-center">
      <div class="row">
        <p class="col-6 d-inline room-params-text">Основной свет:</p>
        <p class="col-6 d-inline room-params-text" id="light_main">%</p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Подсветка:</p>
        <p class="col-6 d-inline room-params-text" id="light_supply">%</p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Свет в коридоре:</p>
        <p class="col-6 d-inline room-params-text" id="light_corridor">%</p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Свет в санузле:</p>
        <p class="col-6 d-inline room-params-text" id="light_bath">%</p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Шторы:</p>
        <p class="col-6 d-inline room-params-text" id="light_blinds"></p>
      </div>
    </div>
    <div class="col-lg-6 text-center">
      <div class="row">
        <p class="col-6 d-inline room-params-text">Уставка температуры:</p>
        <p class="col-6 d-inline room-params-text" id="climat_temp_sp">%</p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Кондиционер - статус:</p>
        <p class="col-6 d-inline room-params-text" id="climat_fan_on_off">%</p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Кондиционер - скорость:</p>
        <p class="col-6 d-inline room-params-text" id="climat_fan_speed">%</p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Кондиционер - режим:</p>
        <p class="col-6 d-inline room-params-text" id="climat_fan_auto_mode"></p>
      </div>
      <div class="row">
        <p class="col-6 d-inline room-params-text">Клапан батареи:</p>
        <p class="col-6 d-inline room-params-text" id="climat_heat_valve">%</p>
      </div>
    </div>
  </div>

  <script defer>
    function getRoomData(room_id) {
        let url = "{% url 'room' %}" + "{{ url_api }}" + room_id;

        fetch(url)

            .then(response => response.json())

            .then(data => {
                console.log(typeof data)
                for (light_source in data) {
                    console.log(typeof light_source)
                    console.log(typeof data[light_source])

                }
                document.getElementById('room_content').classList.remove('d-none')

                document.getElementById('room_number').textContent = 'Номер ' + data['number']

                for (light_source in data['light']) {
                    console.log(light_source)
                    let value = data['light'][light_source]
                    let id_light_selector = 'light_' + light_source
                    if (light_source === 'blinds') {
                        document.getElementById(id_light_selector).textContent = value ? 'Открыты' :
                            'Закрыты'
                    } else {
                        document.getElementById(id_light_selector).textContent = value + "%"
                    }
                }

                for (climat_parameter in data['climat']) {
                    let value = data['climat'][climat_parameter]
                    let id_climat_selector = 'climat_' + climat_parameter
                    if (climat_parameter === 'fan_on_off') {
                        document.getElementById(id_climat_selector).textContent = value ? 'Включен' : 'Отключен'
                    } else if (climat_parameter === 'fan_auto_mode') {
                        document.getElementById(id_climat_selector).textContent = value ? 'Автоматический' : 'Ручной'
                    } else if (climat_parameter === 'temp_sp') {
                        document.getElementById(id_climat_selector).textContent = value + "℃"
                    } else {
                        document.getElementById(id_climat_selector).textContent = value + "%"
                    }
                }
            })

            .catch(error => {
                let error_msg = document.getElementById('error_msg')
                error_msg.classList.remove('d-none')
                error_msg.textContent = error
            });







    }

  </script>

{% endblock %}